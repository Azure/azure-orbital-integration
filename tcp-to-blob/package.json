{
  "name": "@azure/tcp-to-blob",
  "version": "1.0.0",
  "description": "TCP to BLOB",
  "scripts": {
    "build": "npx esbuild ./src/tcp-*.ts ./src/makeEnvFiles.ts ./src/makeContactProfile.ts --bundle --platform=node --outdir=./dist/bundle",
    "clean": "rm -rf ./dist & rm -rf ./node_modules",
    "make-env-files": "node ./dist/bundle/makeEnvFiles.js",
    "make-contact-profile": "node ./dist/bundle/makeContactProfile.js",
    "deploy-fast": "yarn make-env-files && kubectl apply -f ./dist/env/${NAME_PREFIX}/tcp-to-blob.yaml",
    "deploy": "yarn docker-push && yarn deploy-fast",
    "check-raw-blob-name": "[[ -z \"$RAW_DATA_BLOB_NAME\" ]] && { echo 'Must set \"RAW_DATA_BLOB_NAME\".'; exit 1; } || echo RAW_DATA_BLOB_NAME = \"${RAW_DATA_BLOB_NAME}\"",
    "deploy-dashboard": "yarn make-env-files && az portal dashboard create --resource-group \"${AZ_RESOURCE_GROUP}\" --name \"${NAME_PREFIX}-dashboard\" --input-path \"./dist/env/${NAME_PREFIX}/dashboard.json\" --location \"${AZ_LOCATION}\"",
    "run-text-canary": ". ./deploy/env-defaults.sh && echo \"Canary sending TEXT data to ${AKS_NAME}.\" && yarn make-env-files && kubectl delete --ignore-not-found=true -f ./dist/env/${NAME_PREFIX}/tcp-to-blob-text-canary.yaml && kubectl apply -f ./dist/env/${NAME_PREFIX}/tcp-to-blob-text-canary.yaml",
    "deploy-text-canary-cron": ". ./deploy/env-defaults.sh && echo \"Deploying TEXT canary cron to periodically send data to ${AKS_NAME}.\" && yarn make-env-files && kubectl delete --ignore-not-found=true -f ./dist/env/${NAME_PREFIX}/tcp-to-blob-text-canary-cron.yaml && kubectl apply -f ./dist/env/${NAME_PREFIX}/tcp-to-blob-text-canary-cron.yaml",
    "run-raw-canary": "yarn check-raw-blob-name && . ./deploy/env-defaults.sh && echo \"Canary RAW data to ${AKS_NAME}.\" && yarn make-env-files && kubectl delete --ignore-not-found=true -f ./dist/env/${NAME_PREFIX}/tcp-to-blob-raw-canary.yaml && kubectl apply -f ./dist/env/${NAME_PREFIX}/tcp-to-blob-raw-canary.yaml",
    "deploy-raw-canary-cron": "yarn check-raw-blob-name && . ./deploy/env-defaults.sh && echo \"Deploying RAW canary cron to periodically send data to  ${AKS_NAME}.\" && yarn make-env-files && kubectl delete --ignore-not-found=true -f ./dist/env/${NAME_PREFIX}/tcp-to-blob-raw-canary-cron.yaml && kubectl apply -f ./dist/env/${NAME_PREFIX}/tcp-to-blob-raw-canary-cron.yaml",
    "re-deploy": "yarn docker-push && kubectl patch deployment tcp-to-blob-deployment -p \"{\\\"spec\\\":{\\\"template\\\":{\\\"metadata\\\":{\\\"labels\\\":{\\\"date\\\":\\\"`date +'%s'`\\\"}}}}}\"\n",
    "docker-build": "yarn build && docker build . -f deploy/Dockerfile -t tcp-to-blob --platform linux/amd64",
    "docker-build-text-canary": "yarn build && docker build . -f deploy/Dockerfile-text-canary -t tcp-to-blob-text-canary --platform linux/amd64",
    "docker-build-raw-canary": "yarn build && docker build . -f deploy/Dockerfile-raw-canary -t tcp-to-blob-raw-canary --platform linux/amd64",
    "docker-run": ". ./deploy/env-defaults.sh && docker run --env CONTACT_DATA_STORAGE_CONNECTION_STRING --env HOST --env PORT --env CONTACT_DATA_STORAGE_CONTAINER  --env AKS_ORBITAL_SUBNET_ADDR_PREFIX --env AKS_POD_SUBNET_ADDR_PREFIX -p $PORT:$PORT tcp-to-blob",
    "docker-kill-all": "docker kill $(docker ps -q)",
    "docker-tag": "docker tag tcp-to-blob:latest ${ACR_NAME}.azurecr.io/tcp-to-blob:latest",
    "docker-tag-text-canary": "docker tag tcp-to-blob-text-canary:latest $ACR_NAME.azurecr.io/tcp-to-blob-text-canary:latest",
    "docker-tag-raw-canary": "docker tag tcp-to-blob-raw-canary:latest $ACR_NAME.azurecr.io/tcp-to-blob-raw-canary:latest",
    "az-login": "./deploy/check-required-env.sh && . ./deploy/env-defaults.sh && az aks get-credentials --resource-group ${AZ_RESOURCE_GROUP} --name ${AKS_NAME} && az acr login --name ${ACR_NAME}",
    "docker-push": "yarn docker-build && yarn docker-tag && docker push ${ACR_NAME}.azurecr.io/tcp-to-blob:latest",
    "docker-push-text-canary": "yarn docker-build-text-canary && yarn docker-tag-text-canary && docker push ${ACR_NAME}.azurecr.io/tcp-to-blob-text-canary:latest",
    "docker-push-raw-canary": "yarn docker-build-raw-canary && yarn docker-tag-raw-canary && docker push ${ACR_NAME}.azurecr.io/tcp-to-blob-raw-canary:latest",
    "compile-watch": "npx tsc -w",
    "compile": "yarn prettier && npx tsc",
    "test": "ts-mocha -p tsconfig.json tests/*.ts",
    "coverage": "nyc yarn test",
    "prettier": "npx prettier . -w",
    "run-server": "yarn build && cd ./dist && node ./bundle/tcp-to-blob.js"
  },
  "keywords": [
    "Azure",
    "Obrital"
  ],
  "author": "micholas",
  "license": "MIT",
  "dependencies": {
    "@azure/arm-orbital-helper": "^1.0.0",
    "@azure/storage-blob": "^12.10.0",
    "@types/uuid": "^8.3.4",
    "ip": "^1.1.8",
    "uuid": "^9.0.0"
  },
  "devDependencies": {
    "@types/chai": "^4.3.3",
    "@types/commander": "^2.12.2",
    "@types/expect": "^24.3.0",
    "@types/ip": "^1.1.0",
    "@types/lodash": "^4.14.182",
    "@types/mocha": "^9.1.1",
    "@types/node": "^17.0.41",
    "@types/sinon": "^10.0.13",
    "chai": "^4.3.6",
    "commander": "^9.4.0",
    "esbuild": "^0.14.42",
    "lodash": "^4.17.21",
    "mocha": "^10.0.0",
    "nyc": "^15.1.0",
    "prettier": "^2.7.1",
    "sinon": "^14.0.0",
    "sinon-chai": "^3.7.0",
    "ts-mocha": "^10.0.0",
    "typescript": "^4.8.2"
  }
}
